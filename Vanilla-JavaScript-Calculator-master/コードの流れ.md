- [number-operation-number-equal](#number-operation-number-equal)
  - [A: number](#a-number)
  - [B: operation](#b-operation)
  - [C: number](#c-number)
  - [D: equal](#d-equal)

## number-operation-number-equal
### A: number
1. ```js
    button.addEventListener('click', () => {
    calculator.appendNumber(button.innerText);
    calculator.updateDisplay();
    ```
    - 数字ボタンを押した際の処理を受け付けるイベントリスナー
    - `appendNumber()`に数字を送る
    - `updateDisplay()`で画面を更新する
2. ```js
    appendNumber(number) {
    ...
    this.currentOperand =
        this.currentOperand.toString() + number.toString();
    }
    ```
    - 送られてきた数字を文字列化し(`number.toString()`)、既存の数文字列に追加する

3. ```js
    updateDisplay() {
    this.currentOperandTextElement.innerText =
        this.getDisplayNumber(this.currentOperand);
    ...
    ```
    - この時点の`this.currentOperand`の値を`this.getDisplayNumber`に送る

4. ```js
    getDisplayNumber(number) {
    const stringNumber = number.toString();
    const integerDigits = parseFloat(stringNumber.split('.')[0]);// 数文字列を整形するために一度数値化する
    const decimalDigits = stringNumber.split('.')[1];
    let integerDisplay; //`updateDisplay()`に渡る(文字列)

    if (isNaN(integerDigits)) {
      integerDisplay = '';
    } else {
      integerDisplay = integerDigits.toLocaleString('en', { maximumFractionDigits: 0 });
        // ','をつけて文字列化し変数に渡す
    }

        if (decimalDigits != null) {
      //この`if`内の`integerDisplay`は上で文字列化したもの
      return `${integerDisplay}.${decimalDigits}`;
    } else {
      return integerDisplay;
    }
    }
    ```
    - `updateDisplay()`から送られてきた数文字列を`toStriing()`で文字列化して定数に代入する
    - その定数を`split()`を使い小数点で整数部分と小数部分を分けて整数部分を定数に代入する
      - そして以下で`toLocalString`を用いて整形するために一度`parseFloat`で数値化する
5. ```js
    updateDisplay() {
    this.currentOperandTextElement.innerText =
        this.getDisplayNumber(this.currentOperand);

    if (this.operation != null) {
      this.previousOperandTextElement.innerText =
        `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
    } else {
      this.previousOperandTextElement.innerText = '';
    }}
    ```
    - `getDisplayNumber()`で整形された数文字列を`this.currentOperandTextElement.innerText`に代入し、画面に入力した数字を表示させる
    - `if(this.operation != null)`以下の条件分は、この時点でオペレーションが未選択なので、`else`以下が実行される

### B: operation
1. ```js
    operationButtons.forEach(button => {
        button.addEventListener('click', () => {
        calculator.chooseOperation(button.innerText);
        calculator.updateDisplay();
    });});
    ```
    - オペレーションボタンを押した際に処理するイベントリスナー
    - 押したボタンは`chooseOperation(button.innerText)`に送られる
    - `updateDisplay()`で画面の更新を行う
2. ```js
    chooseOperation(operation) {
    if (this.currentOperand === '') return;

    if (this.previousOperand !== '') {　this.compute();　}

    this.operation = operation;
    this.previousOperand = this.currentOperand;
    this.currentOperand = '';
    }
    ```
    - `if (this.currentOperand === '') return;` で、`currentOperand`が未入力の場合は`return`でスルーされ、以降のコードは実行されない
    - `if (this.previousOperand !== '') {　this.compute(); }`　は、この時点で`previousOperand`に値が無いため実行されない
    - 入力された`operation`をプロパティに代入し、`compute()`や`updateDisplay()`, で使われる
    - A: numberで入力された数字`this.currentOperand`を`this.previousOperand`に代入した上で空文字にし新しい数字の受付を可能にする
3. ```js
    updateDisplay() {
    this.currentOperandTextElement.innerText =
      this.getDisplayNumber(this.currentOperand);

    if (this.operation != null) {
      this.previousOperandTextElement.innerText =
        `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
    } else { this.previousOperandTextElement.innerText = ''; }}
    ```
    - `this.currentOperandTextElement.innerText`以下は、`this.currentOperand`が空であるためディスプレイの表示がリセットされるようになる
    - `if(this.operation != null)`で`chooseOperation()`で値を代入された`this.previousOperand`を表示させる

### C: number
1. ```js
    numberButtons.forEach(button => {
    button.addEventListener('click', () => {
    calculator.appendNumber(button.innerText);
    calculator.updateDisplay();
    });});
    ```
    - 新しい数字を受け付ける
2. ```js
    appendNumber(number) {
    if (number === '.' && this.currentOperand.includes('.')) return;

    this.currentOperand = this.currentOperand.toString() + number.toString();
    }
    ```
    - A: numberと同じような処理を行う
3. ```js
    updateDisplay() {
    this.currentOperandTextElement.innerText =
      this.getDisplayNumber(this.currentOperand);

    if (this.operation != null) {
      this.previousOperandTextElement.innerText =
        `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
    } else {
      this.previousOperandTextElement.innerText = '';
    }}
    ```
    - `this.getDisplayNumber()`に`this.appendNumber()`で数字を追加された数文字列を送る
4. ```js
    getDisplayNumber(number) {
    const stringNumber = number.toString();
    const integerDigits = parseFloat(stringNumber.split('.')[0]);
    const decimalDigits = stringNumber.split('.')[1];
    let integerDisplay;

    if (isNaN(integerDigits)) { integerDisplay = ''; }
    else
    { integerDisplay = integerDigits.toLocaleString('en', { maximumFractionDigits: 0 }); }

    if (decimalDigits != null) { return `${integerDisplay}.${decimalDigits}`; }
    else
    { return integerDisplay; }}
    ```
    - 送られた数文字列を文字列化し、整数部分を数値化、`if`で整形された文字列に変換する
    - もし小数部分が含まれている場合は上の`if`で整形された文字列 + 小数部分の文字列を`return`する
5. ```js
    updateDisplay() {
    this.currentOperandTextElement.innerText =
      this.getDisplayNumber(this.currentOperand);

    if (this.operation != null) {
      this.previousOperandTextElement.innerText =
        `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
    } else { this.previousOperandTextElement.innerText = ''; }}
    ```
    - この時点でオペレーションは選択済みなので、`if(this.operation != null)`以下でサブディスプレイに`this.previousOperand`と`this.operation`を表示させる処理を行う

### D: equal
1. ```js
    equalsButton.addEventListener('click', button => {
    calculator.compute();
    calculator.updateDisplay();});
    ```
2. ```js
    compute() {
    let computation;
    const prev = parseFloat(this.previousOperand);
    const current = parseFloat(this.currentOperand);
    if (isNaN(prev) || isNaN(current)) return;

    switch (this.operation) {
      case '+': computation = prev + current; break;
      case '-': computation = prev - current; break;
      case '*': computation = prev * current; break;
      case '÷': computation = prev / current; break;
      default: return; }

    this.currentOperand = computation;
    this.operation = undefined;
    this.previousOperand = ''; }
    ```
    - `const prev`や`const current`は計算を実行するために`parseFloat`で数値化する
    - `switch`で`this.operation`の値に応じて計算を実行し、結果を`computation`に代入する
    - `this.currentOperand`に`computation`(数値)の値を代入する
    - 次の計算に備えるため、`this.operation`と`this.previousOperand`は初期化する
3. ```js
    updateDisplay() {
    this.currentOperandTextElement.innerText =
      this.getDisplayNumber(this.currentOperand);

    if (this.operation != null) {
      this.previousOperandTextElement.innerText =
        `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
    } else { this.previousOperandTextElement.innerText = ''; }}
    ```
    - この時点で数値を格納する`this.currentOperand`を表示できるようにするため`this.getDisplayNumber()`に送る
    - 戻り値が計算結果であり、`this.currentOperandTextElement.innerText`に渡して計算結果を表示する
    - `if`については、`this.operation`は初期化されて`undefined`になっているので`else`以下でサブディスプレイを空にする